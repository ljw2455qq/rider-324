<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>RealtimeIRL Map with Custom Marker</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
    <script src="https://mapbox.github.io/mapbox-gl-language/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@rtirl/api@latest/lib/index.min.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        background: transparent;
      }
      #map {
        width: 300px;
        height: 250px;
        border-radius: 10px;
        overflow: hidden;
      }
      .mapboxgl-ctrl-logo,
      .mapboxgl-ctrl-attrib {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const ACCESS_TOKEN = "pk.eyJ1IjoiaG9vbmNvbSIsImEiOiJjbWNjM3R4enUwM3pnMmlxMWJvZTVrMWIzIn0.h_-BNK4FuriEfFWXvE1pmw";
      const PULL_KEY = "zeoeyze9htbyx455";

      mapboxgl.accessToken = ACCESS_TOKEN;
      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/streets-v12",
        center: [126.9780, 37.5665],
        zoom: 15,
        interactive: false,
        attributionControl: false,
      });

      map.addControl(new MapboxLanguage({ defaultLanguage: "ko" }));

      // ✅ profile.png 마커 생성
      const el = document.createElement("div");
      el.style.backgroundImage = 'url("profile.png")';
      el.style.width = "24px";
      el.style.height = "24px";
      el.style.backgroundSize = "cover";
      el.style.borderRadius = "50%";
      el.style.border = "2px solid white";
      el.style.boxShadow = "0 0 8px rgba(0,0,0,0.5)";

      const marker = new mapboxgl.Marker(el)
        .setLngLat([126.9780, 37.5665])
        .addTo(map);

      // ✅ 실시간 위치 업데이트
      RealtimeIRL.forPullKey(PULL_KEY).addLocationListener((location) => {
        if (location.latitude && location.longitude) {
          marker.setLngLat([location.longitude, location.latitude]);
          map.panTo([location.longitude, location.latitude], {
            duration: 1500,
            easing: (x) => x,
          });
        }
      });
    </script>
  </body>
</html>
